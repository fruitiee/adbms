import tkinter as tk
from tkinter import messagebox
import sqlite3

# ---------------- Database Setup ----------------
conn = sqlite3.connect("students.db")
cursor = conn.cursor()

cursor.execute("""
CREATE TABLE IF NOT EXISTS students (
    id TEXT PRIMARY KEY,
    name TEXT,
    age INTEGER,
    course TEXT,
    marks REAL
)
""")
conn.commit()

# ---------------- Functions ----------------
def add_student():
    try:
        cursor.execute("INSERT INTO students VALUES (?, ?, ?, ?, ?)",
                       (id_entry.get(), name_entry.get(),
                        age_entry.get(), course_entry.get(),
                        marks_entry.get()))
        conn.commit()
        messagebox.showinfo("Success", "Student Added Successfully")
        clear_entries()
    except sqlite3.IntegrityError:
        messagebox.showerror("Error", "Student ID already exists!")

def search_student():
    cursor.execute("SELECT * FROM students WHERE id = ?", (id_entry.get(),))
    student = cursor.fetchone()

    if student:
        name_entry.delete(0, tk.END)
        age_entry.delete(0, tk.END)
        course_entry.delete(0, tk.END)
        marks_entry.delete(0, tk.END)

        name_entry.insert(0, student[1])
        age_entry.insert(0, student[2])
        course_entry.insert(0, student[3])
        marks_entry.insert(0, student[4])
    else:
        messagebox.showerror("Error", "Student Not Found!")

def update_student():
    cursor.execute("""
    UPDATE students
    SET name=?, age=?, course=?, marks=?
    WHERE id=?
    """, (name_entry.get(), age_entry.get(),
          course_entry.get(), marks_entry.get(),
          id_entry.get()))
    conn.commit()

    if cursor.rowcount == 0:
        messagebox.showerror("Error", "Student Not Found!")
    else:
        messagebox.showinfo("Success", "Student Updated Successfully")
        clear_entries()

def delete_student():
    cursor.execute("DELETE FROM students WHERE id=?", (id_entry.get(),))
    conn.commit()

    if cursor.rowcount == 0:
        messagebox.showerror("Error", "Student Not Found!")
    else:
        messagebox.showinfo("Success", "Student Deleted Successfully")
        clear_entries()

def view_students():
    cursor.execute("SELECT * FROM students")
    records = cursor.fetchall()

    display = ""
    for student in records:
        display += f"ID: {student[0]}, Name: {student[1]}, Course: {student[3]}, Marks: {student[4]}\n"

    messagebox.showinfo("All Students", display if display else "No Records Found")

def clear_entries():
    id_entry.delete(0, tk.END)
    name_entry.delete(0, tk.END)
    age_entry.delete(0, tk.END)
    course_entry.delete(0, tk.END)
    marks_entry.delete(0, tk.END)

# ---------------- GUI ----------------
root = tk.Tk()
root.title("Student Information System - SQLite")
root.geometry("400x450")

tk.Label(root, text="Student Information System", font=("Arial", 14, "bold")).pack(pady=10)

tk.Label(root, text="Student ID").pack()
id_entry = tk.Entry(root)
id_entry.pack()

tk.Label(root, text="Name").pack()
name_entry = tk.Entry(root)
name_entry.pack()

tk.Label(root, text="Age").pack()
age_entry = tk.Entry(root)
age_entry.pack()

tk.Label(root, text="Course").pack()
course_entry = tk.Entry(root)
course_entry.pack()

tk.Label(root, text="Marks").pack()
marks_entry = tk.Entry(root)
marks_entry.pack()

tk.Button(root, text="Add Student", command=add_student).pack(pady=5)
tk.Button(root, text="Search Student", command=search_student).pack(pady=5)
tk.Button(root, text="Update Student", command=update_student).pack(pady=5)
tk.Button(root, text="Delete Student", command=delete_student).pack(pady=5)
tk.Button(root, text="View All Students", command=view_students).pack(pady=5)
tk.Button(root, text="Clear", command=clear_entries).pack(pady=5)

root.mainloop()

conn.close()
