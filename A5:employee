import tkinter as tk
from tkinter import ttk, messagebox


class Employee:
    def __init__(self, emp_id, name, department, salary):
        self.emp_id = emp_id.strip().upper()
        self.name = name.strip()
        self.department = department.strip()
        self.salary = float(salary)


class EmployeeManagementApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Employee Management System")
        self.root.geometry("980x580")

        self.employees = {}
        self.next_id_number = 1

        self.create_widgets()

    # -----------------------------
    # ID Generator
    # -----------------------------
    def generate_employee_id(self):
        emp_id = f"EMP{self.next_id_number:04d}"
        self.next_id_number += 1
        return emp_id

    # -----------------------------
    # UI
    # -----------------------------
    def create_widgets(self):

        ttk.Label(
            self.root,
            text="Employee Management",
            font=("Helvetica", 18, "bold")
        ).pack(pady=10)

        # LEFT FORM
        form_frame = ttk.LabelFrame(self.root, text=" Employee Details ", padding=12)
        form_frame.pack(side=tk.LEFT, padx=15, pady=10, fill=tk.Y)

        labels = ["Employee ID", "Full Name *", "Department *", "Monthly Salary (₹) *"]
        self.entries = {}

        for i, label in enumerate(labels):
            ttk.Label(form_frame, text=label).grid(row=i, column=0, padx=10, pady=8, sticky="e")
            entry = ttk.Entry(form_frame, width=30)
            entry.grid(row=i, column=1, padx=10, pady=8)
            self.entries[label] = entry

        self.entries["Employee ID"].config(state="disabled")

        btn_frame = ttk.Frame(form_frame)
        btn_frame.grid(row=4, column=0, columnspan=2, pady=15)

        ttk.Button(btn_frame, text="Add New Employee",
                   command=self.add_employee).grid(row=0, column=0, padx=6)

        ttk.Button(btn_frame, text="Update Selected",
                   command=self.update_employee).grid(row=0, column=1, padx=6)

        ttk.Button(btn_frame, text="Clear Form",
                   command=self.clear_form).grid(row=1, column=0, columnspan=2, pady=8)

        # RIGHT SIDE
        right_frame = ttk.Frame(self.root)
        right_frame.pack(side=tk.RIGHT, padx=15, pady=10, fill=tk.BOTH, expand=True)

        # Search
        search_frame = ttk.LabelFrame(right_frame, text=" Search ", padding=10)
        search_frame.pack(fill="x", pady=(0, 10))

        ttk.Label(search_frame, text="Name or ID:").grid(row=0, column=0, padx=8)
        self.search_entry = ttk.Entry(search_frame, width=30)
        self.search_entry.grid(row=0, column=1, padx=8)

        ttk.Button(search_frame, text="Search",
                   command=self.search_employees).grid(row=0, column=2, padx=8)

        ttk.Button(search_frame, text="Show All",
                   command=self.show_all).grid(row=0, column=3, padx=8)

        # Table
        columns = ("ID", "Name", "Department", "Salary")
        self.tree = ttk.Treeview(right_frame, columns=columns,
                                 show="headings", height=15)

        self.tree.heading("ID", text="Employee ID")
        self.tree.heading("Name", text="Name")
        self.tree.heading("Department", text="Department")
        self.tree.heading("Salary", text="Salary ₹")

        self.tree.column("ID", width=110, anchor="center")
        self.tree.column("Name", width=220)
        self.tree.column("Department", width=160)
        self.tree.column("Salary", width=130, anchor="e")

        self.tree.pack(fill=tk.BOTH, expand=True)
        self.tree.bind("<<TreeviewSelect>>", self.on_row_select)

        # Bottom buttons
        action_frame = ttk.Frame(right_frame)
        action_frame.pack(fill="x", pady=10)

        ttk.Button(action_frame, text="Delete Selected",
                   command=self.delete_employee).pack(side=tk.LEFT, padx=8)

        ttk.Button(action_frame, text="Refresh List",
                   command=self.show_all).pack(side=tk.RIGHT, padx=8)

    # -----------------------------
    # ADD
    # -----------------------------
    def add_employee(self):
        name = self.entries["Full Name *"].get().strip()
        dept = self.entries["Department *"].get().strip()
        salary_str = self.entries["Monthly Salary (₹) *"].get().strip()

        if not name or not dept or not salary_str:
            messagebox.showwarning("Required", "All fields are required")
            return

        try:
            salary = float(salary_str.replace(",", ""))
            if salary <= 0:
                raise ValueError
        except:
            messagebox.showerror("Invalid", "Salary must be positive number")
            return

        emp_id = self.generate_employee_id()
        self.employees[emp_id] = Employee(emp_id, name, dept, salary)

        messagebox.showinfo("Success", f"Employee Added\nID: {emp_id}")
        self.show_all()
        self.clear_form()

    # -----------------------------
    # UPDATE
    # -----------------------------
    def update_employee(self):
        selected = self.tree.selection()
        if not selected:
            messagebox.showwarning("Not Found", "Select an employee first")
            return

        emp_id = self.tree.item(selected)["values"][0]

        name = self.entries["Full Name *"].get().strip()
        dept = self.entries["Department *"].get().strip()
        salary_str = self.entries["Monthly Salary (₹) *"].get().strip()

        if not name or not dept or not salary_str:
            messagebox.showwarning("Required", "All fields required")
            return

        try:
            salary = float(salary_str.replace(",", ""))
            if salary <= 0:
                raise ValueError
        except:
            messagebox.showerror("Invalid", "Salary must be positive number")
            return

        emp = self.employees[emp_id]
        emp.name = name
        emp.department = dept
        emp.salary = salary

        messagebox.showinfo("Updated", "Employee updated successfully")
        self.show_all()
        self.clear_form()

    # -----------------------------
    # DELETE
    # -----------------------------
    def delete_employee(self):
        selected = self.tree.selection()
        if not selected:
            messagebox.showwarning("Warning", "Select an employee first")
            return

        emp_id = self.tree.item(selected)["values"][0]
        del self.employees[emp_id]

        messagebox.showinfo("Deleted", "Employee deleted")
        self.show_all()
        self.clear_form()

    # -----------------------------
    # SEARCH
    # -----------------------------
    def search_employees(self):
        query = self.search_entry.get().lower()
        self.tree.delete(*self.tree.get_children())

        for emp_id, emp in self.employees.items():
            if query in emp_id.lower() or query in emp.name.lower():
                self.tree.insert("", "end", values=(
                    emp_id, emp.name, emp.department,
                    f"{emp.salary:,.2f}"
                ))

    # -----------------------------
    # SHOW ALL
    # -----------------------------
    def show_all(self):
        self.tree.delete(*self.tree.get_children())
        for emp_id in sorted(self.employees.keys()):
            emp = self.employees[emp_id]
            self.tree.insert("", "end", values=(
                emp_id, emp.name, emp.department,
                f"{emp.salary:,.2f}"
            ))

    # -----------------------------
    # ROW SELECT
    # -----------------------------
    def on_row_select(self, event):
        selected = self.tree.selection()
        if not selected:
            return

        values = self.tree.item(selected)["values"]

        self.entries["Employee ID"].config(state="normal")
        self.clear_form()

        self.entries["Employee ID"].insert(0, values[0])
        self.entries["Employee ID"].config(state="disabled")

        self.entries["Full Name *"].insert(0, values[1])
        self.entries["Department *"].insert(0, values[2])
        self.entries["Monthly Salary (₹) *"].insert(0, values[3])

    # -----------------------------
    # CLEAR
    # -----------------------------
    def clear_form(self):
        for entry in self.entries.values():
            entry.config(state="normal")
            entry.delete(0, tk.END)

        self.entries["Employee ID"].config(state="disabled")


if __name__ == "__main__":
    root = tk.Tk()
    app = EmployeeManagementApp(root)
    root.mainloop()
