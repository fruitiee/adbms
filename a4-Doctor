import tkinter as tk
from tkinter import messagebox
import sqlite3
import uuid

# ---------------- Database Setup ----------------
conn = sqlite3.connect("hospital.db")
cursor = conn.cursor()

cursor.execute("""
CREATE TABLE IF NOT EXISTS doctors (
    doctor_id TEXT PRIMARY KEY,
    name TEXT,
    specialization TEXT,
    available_time TEXT
)
""")

cursor.execute("""
CREATE TABLE IF NOT EXISTS appointments (
    appointment_id TEXT PRIMARY KEY,
    patient_name TEXT,
    doctor_id TEXT,
    date TEXT,
    time TEXT,
    contact TEXT
)
""")
conn.commit()

# ---------------- Functions ----------------

def add_doctor():
    doc_id = doctor_id_entry.get()
    name = doctor_name_entry.get()
    spec = specialization_entry.get()
    time = available_time_entry.get()

    try:
        cursor.execute("INSERT INTO doctors VALUES (?, ?, ?, ?)",
                       (doc_id, name, spec, time))
        conn.commit()
        messagebox.showinfo("Success", "Doctor Added Successfully")
    except:
        messagebox.showerror("Error", "Doctor ID Already Exists")

def book_appointment():
    app_id = str(uuid.uuid4())[:8]
    patient = patient_name_entry.get()
    doctor = doctor_id_book_entry.get()
    date = date_entry.get()
    time = time_entry.get()
    contact = contact_entry.get()

    cursor.execute("INSERT INTO appointments VALUES (?, ?, ?, ?, ?, ?)",
                   (app_id, patient, doctor, date, time, contact))
    conn.commit()
    messagebox.showinfo("Success", f"Appointment Booked\nID: {app_id}")

def view_appointments():
    cursor.execute("SELECT * FROM appointments")
    records = cursor.fetchall()

    result = ""
    for row in records:
        result += f"{row}\n"

    messagebox.showinfo("Appointments", result)

def cancel_appointment():
    app_id = cancel_entry.get()
    cursor.execute("DELETE FROM appointments WHERE appointment_id = ?", (app_id,))
    conn.commit()
    messagebox.showinfo("Success", "Appointment Cancelled")

# ---------------- GUI ----------------

root = tk.Tk()
root.title("Doctor Appointment System")
root.geometry("400x600")

tk.Label(root, text="Doctor Appointment System", font=("Arial", 14, "bold")).pack(pady=10)

# ---- Add Doctor ----
tk.Label(root, text="Doctor ID").pack()
doctor_id_entry = tk.Entry(root)
doctor_id_entry.pack()

tk.Label(root, text="Doctor Name").pack()
doctor_name_entry = tk.Entry(root)
doctor_name_entry.pack()

tk.Label(root, text="Specialization").pack()
specialization_entry = tk.Entry(root)
specialization_entry.pack()

tk.Label(root, text="Available Time").pack()
available_time_entry = tk.Entry(root)
available_time_entry.pack()

tk.Button(root, text="Add Doctor", command=add_doctor).pack(pady=5)

# ---- Book Appointment ----
tk.Label(root, text="Patient Name").pack()
patient_name_entry = tk.Entry(root)
patient_name_entry.pack()

tk.Label(root, text="Doctor ID").pack()
doctor_id_book_entry = tk.Entry(root)
doctor_id_book_entry.pack()

tk.Label(root, text="Date (DD-MM-YYYY)").pack()
date_entry = tk.Entry(root)
date_entry.pack()

tk.Label(root, text="Time").pack()
time_entry = tk.Entry(root)
time_entry.pack()

tk.Label(root, text="Contact").pack()
contact_entry = tk.Entry(root)
contact_entry.pack()

tk.Button(root, text="Book Appointment", command=book_appointment).pack(pady=5)

# ---- View Appointments ----
tk.Button(root, text="View Appointments", command=view_appointments).pack(pady=5)

# ---- Cancel Appointment ----
tk.Label(root, text="Enter Appointment ID to Cancel").pack()
cancel_entry = tk.Entry(root)
cancel_entry.pack()

tk.Button(root, text="Cancel Appointment", command=cancel_appointment).pack(pady=5)

root.mainloop()
